# Release Instructions

This document describes how to release new versions of substack-cli using GoReleaser.

## Prerequisites

1. **Install GoReleaser**: https://goreleaser.com/install/
2. **GitHub Token**: Create a personal access token with `public_repo` scope at https://github.com/settings/tokens
3. **Homebrew Tap**: Create a separate tap repository at `https://github.com/aaronsrivastava/homebrew-tap`

## Setup

### Environment Variables

Export your GitHub token:

```bash
export GITHUB_TOKEN=your_github_token_here
```

Or create a `.env.release` file with:

```bash
export GITHUB_TOKEN=your_github_token_here
```

Source it before releasing:
```bash
source .env.release
```

### Homebrew Tap Repository

The tap is stored in this repository at `homebrew-tap/`. The structure is:
```
homebrew-tap/
├── Formula/
│   └── substack-cli.rb (auto-generated by GoReleaser during releases)
└── README.md
```

No separate tap repository is needed - GoReleaser will update the formula directly in this repo.

## Releasing a New Version

### 1. Update version numbers

Edit `main.go` to update the version constant (optional - GoReleaser uses git tags):

```go
const version = "v1.0.0"
```

### 2. Create a git tag

```bash
git tag -a v1.0.0 -m "Release v1.0.0: Description of changes"
git push origin v1.0.0
```

### 3. Run GoReleaser

```bash
export GITHUB_TOKEN=your_token_here
goreleaser release --clean
```

This will:
- Build binaries for Linux (amd64, arm64), macOS (amd64, arm64), and Windows (amd64, arm64)
- Create GitHub release with artifacts
- Update the Homebrew formula in `homebrew-tap/Formula/`
- Commit and push the updated formula back to this repository

### 4. Verify the release

**GitHub**: Check https://github.com/aaronsrivastava/substack-cli/releases
**Homebrew**: Users can now install with:
```bash
brew install aaronsrivastava/tap/substack-cli
```

**APT**: For Debian/Ubuntu users, releases are available as `.deb` files

## Version Numbering

This project uses [Semantic Versioning](https://semver.org/):

- **MAJOR.MINOR.PATCH** (e.g., 1.2.3)
- **MAJOR**: Breaking changes
- **MINOR**: New features (backward compatible)
- **PATCH**: Bug fixes

Examples:
- `v0.1.0` - Initial release
- `v1.0.0` - First stable release
- `v1.1.0` - New feature
- `v1.1.1` - Bug fix
- `v2.0.0` - Breaking change

## Distribution Channels

### Homebrew (macOS/Linux)
```bash
brew tap aaronsrivastava/substack-cli https://github.com/aaronsrivastava/substack-cli
brew install substack-cli
brew upgrade substack-cli
```

### APT (Debian/Ubuntu)
Download the `.deb` file from GitHub releases and install:
```bash
sudo dpkg -i substack-cli_*.deb
```

Or add a PPA (requires additional setup).

### Windows
Download the `.zip` file from GitHub releases and extract it.
Add the directory to your PATH, or use a package manager like Scoop.

## Dry Run

To test without releasing:

```bash
goreleaser release --skip-publish --clean
```

This creates artifacts in `dist/` without uploading to GitHub.

## Troubleshooting

**"signature does not include certs"**
```bash
git tag -d v1.0.0  # Delete local tag
git push origin :refs/tags/v1.0.0  # Delete remote tag
git tag -a v1.0.0 -m "Release v1.0.0"
git push origin v1.0.0
```

**GoReleaser not found**
```bash
go install github.com/goreleaser/goreleaser@latest
```

**Homebrew formula not updating**
Check that `HOMEBREW_TAP_TOKEN` has been exported and has sufficient permissions.
